<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
    
    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <link rel="stylesheet" href="donor.css">
</head>
<body>

    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <div class="logo">
                <div class="logo-icon">‚ù§</div>
                <div class="logo-text">PULSE POINT</div>
            </div>
            <nav class="nav-links">
                <a href="home.html" class="nav-link">Home</a>
                <a href="donor.html" class="nav-link">Donors</a>
                <a href="finder.html" class="nav-link">Centers</a>
                <a href="contact.html" class="nav-link">Contact</a>
            </nav>
        </div>
    </header>

    <!-- Profile Content -->
    <div class="profile-container">
        <div class="profile-card">
            <div class="profile-header">
                <div class="blood-type">ü©∏ <span id="bloodGroup">N/A</span></div>
                <h1 id="userName">Loading...</h1>
                <p>Certified Blood Donor Hero</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <h3 id="totalDonations">0</h3>
                    <p>Total Donations</p>
                    <small>Since 2020</small>
                </div>
                <div class="stat-card">
                    <h3 id="bloodDonated">0L</h3>
                    <p>Blood Donated</p>
                    <small>‚âà <span id="livesSaved">0</span> Lives Saved</small>
                </div>
                <div class="stat-card">
                    <h3 id="daysSinceLast">N/A</h3>
                    <p>Last Donation</p>
                    <small>Next available in <span id="nextAvailable">N/A</span> days</small>
                </div>
            </div>

            <div class="detail-section">
                <div class="detail-item">
                    <div class="detail-icon">
                        <i class="fas fa-user"></i>
                    </div>
                    <div>
                        <h4>Personal Information</h4>
                        <p>Age: <span id="age">N/A</span> | Gender: <span id="gender">N/A</span></p>
                        <p>Weight: <span id="weight">N/A</span>kg | Height: <span id="height">N/A</span>cm</p>
                    </div>
                </div>

                <div class="detail-item">
                    <div class="detail-icon">
                        <i class="fas fa-map-marker-alt"></i>
                    </div>
                    <div>
                        <h4>Location Details</h4>
                        <p id="location">N/A</p>
                        <p>Nearest Center: <span id="nearestCenter">N/A</span> (<span id="centerDistance">N/A</span>km)</p>
                        <button class="btn-donate">
                            <i class="fas fa-directions"></i> Get Directions
                        </button>
                    </div>
                </div>

                <div class="detail-item">
                    <div class="detail-icon">
                        <i class="fas fa-history"></i>
                    </div>
                    <div>
                        <h4>Donation History</h4>
                        <p>Last Donation: <span id="daysSinceLastHistory">N/A</span> Days Ago</p>
                        <p>Most Frequent Center: <span id="frequentCenter">N/A</span></p>
                        <button class="btn-donate">
                            <i class="fas fa-calendar-alt"></i> Schedule Next
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase JavaScript -->
    <script>
        // Firebase Configuration (Replace with your credentials)
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Function to Load User Profile
        function loadUserProfile() {
            auth.onAuthStateChanged(user => {
                if (user) {
                    const userId = user.uid;  // Get logged-in user ID

                    // Fetch user data from Firestore
                    db.collection("users").doc(userId).get().then(doc => {
                        if (doc.exists) {
                            const userData = doc.data();
                            document.getElementById("bloodGroup").textContent = userData.bloodGroup || "N/A";
                            document.getElementById("userName").textContent = userData.name || "Anonymous";
                            document.getElementById("totalDonations").textContent = userData.totalDonations || 0;
                            document.getElementById("bloodDonated").textContent = `${userData.bloodDonated || 0}L`;
                            document.getElementById("livesSaved").textContent = Math.round((userData.bloodDonated || 0) * 2);
                            document.getElementById("daysSinceLast").textContent = userData.daysSinceLastDonation || "N/A";
                            document.getElementById("nextAvailable").textContent = userData.daysSinceLastDonation ? (56 - userData.daysSinceLastDonation) : "N/A";
                            document.getElementById("age").textContent = userData.age || "N/A";
                            document.getElementById("gender").textContent = userData.gender || "N/A";
                            document.getElementById("weight").textContent = userData.weight || "N/A";
                            document.getElementById("height").textContent = userData.height || "N/A";
                            document.getElementById("location").textContent = `${userData.city}, ${userData.country}`;
                            document.getElementById("nearestCenter").textContent = userData.nearestCenter || "N/A";
                            document.getElementById("centerDistance").textContent = userData.centerDistance || "N/A";
                            document.getElementById("daysSinceLastHistory").textContent = userData.daysSinceLastDonation || "N/A";
                            document.getElementById("frequentCenter").textContent = userData.frequentCenter || "N/A";
                        }
                    }).catch(error => console.error("Error fetching user data:", error));
                }
            });
        }

        // Load Profile Data on Page Load
        window.onload = loadUserProfile;
    </script>

</body>
</html>
